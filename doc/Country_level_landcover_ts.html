<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Country-level time series of land covers</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Country-level time series of land
covers</h1>



<p>FAOSTAT provides annual data on cropland and pasture areas. The
standard GTAP-AEZ model and database also include forests, which are not
provide by FAOSTAT on an annual basis (In addition, the GTAP AEZ
database includes shrublands, grasslands, urban and other covers,
although these are not use in modeling).</p>
<p>This vignette explains how the gridded data on land cover for year
2000 documented HERE is used to estimate the shares of land covers other
than FAOSTAT’s reported croplands and pastures. The vignette covers all
the steps, starting from the data available in bulk download from
FAOSTAT. The resulting dataset is included in gtapshape, documented
[[here]] and available using lazy load gtapshape for easy load.</p>
<div id="download-and-prepare-annual-cropland-pasture-land-and-total-land-area-from-faostat" class="section level2">
<h2><strong>Download and prepare annual cropland, pasture land, and
total land area from FAOSTAT</strong></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">require</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">require</span>(tidyr)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## Bulk download land cover data - 1000 hectares in arable land (item</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">## code 6621), permanent crops (6650), and permanent meadows (6655),</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## and total land area (6601)</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>land_cover.bulk <span class="ot">&lt;-</span> FAOSTAT<span class="sc">::</span><span class="fu">get_faostat_bulk</span>(<span class="at">code =</span> <span class="st">&quot;RL&quot;</span>, <span class="at">data_folder =</span> <span class="fu">tempdir</span>())</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>item_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Arable land&quot;</span>,<span class="st">&quot;Permanent crops&quot;</span>, <span class="st">&quot;Permanent meadows and pastures&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>item_code_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6621</span>, <span class="dv">6650</span>, <span class="dv">6655</span>, <span class="dv">6601</span>)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## Format columns, select the three item codes, choose years</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>land_cover <span class="ot">&lt;-</span> land_cover.bulk <span class="sc">%&gt;%</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(year_code <span class="sc">&gt;</span> <span class="dv">2010</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#    dplyr::filter(year_code == gtap_ref_year) %&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">area_code_m49 =</span> area_code__m49_) <span class="sc">%&gt;%</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">element_code =</span> <span class="fu">as.numeric</span>(element_code),</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>                  <span class="at">area_code_m49 =</span> <span class="fu">substr</span>(area_code_m49, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>                  <span class="at">area_code_m49 =</span> <span class="fu">as.numeric</span>(area_code_m49),</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>                  <span class="at">item_code_fao =</span> item_code) <span class="sc">%&gt;%</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(element_code <span class="sc">==</span> <span class="dv">5110</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(item_code <span class="sc">%in%</span> item_code_list)</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>  <span class="co">#Make a new column showing the iso3 code</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>  land_cover <span class="ot">&lt;-</span> land_cover <span class="sc">%&gt;%</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ISO3 =</span> <span class="fu">tolower</span>(countrycode<span class="sc">::</span><span class="fu">countrycode</span>(area_code_m49, <span class="st">&#39;iso3n&#39;</span>, <span class="st">&#39;iso3c&#39;</span>)))</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>  <span class="co">#The bulk download includes total for the world and regions, so we</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>  <span class="co">#drop all areas where the ISO3 code is missing</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>  land_cover <span class="ot">&lt;-</span> land_cover <span class="sc">%&gt;%</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ISO3))</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>  <span class="co">#Pivot wider so we can make columns for cropland and pastureland</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>  land_cover_wide <span class="ot">&lt;-</span> land_cover <span class="sc">%&gt;%</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(ISO3, year_code, item, value) <span class="sc">%&gt;%</span></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(ISO3, year_code),</span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a>                       <span class="at">names_from =</span> item,</span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a>                       <span class="at">values_from =</span>  value)</span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>  <span class="co">#Rename categories, replace NA values with zeroes</span></span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>  land_cover_wide <span class="ot">&lt;-</span> land_cover_wide <span class="sc">%&gt;%</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">arable =</span> <span class="st">`</span><span class="at">Arable land</span><span class="st">`</span>,</span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>                  <span class="at">permanent_crop =</span> <span class="st">`</span><span class="at">Permanent crops</span><span class="st">`</span>,</span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>                  <span class="at">pasture =</span> <span class="st">`</span><span class="at">Permanent meadows and pastures</span><span class="st">`</span>,</span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a>                  <span class="at">land_area =</span> <span class="st">`</span><span class="at">Land area</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">arable =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(arable), <span class="dv">0</span>, arable),</span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a>                  <span class="at">permanent_crop =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(permanent_crop), <span class="dv">0</span>, permanent_crop),</span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a>                  <span class="at">pasture =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(pasture), <span class="dv">0</span>, pasture),</span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a>                  <span class="at">land_area =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(land_area), <span class="dv">0</span>, land_area))</span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a>  <span class="co">#Now add up the categories to get the values for cropland and pasture.</span></span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a>  <span class="co">#Values are in 1000 ha, convert to ha</span></span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a>  land_cover_wide <span class="ot">&lt;-</span> land_cover_wide <span class="sc">%&gt;%</span></span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cropland =</span> <span class="dv">1000</span><span class="sc">*</span>(arable <span class="sc">+</span> permanent_crop),</span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a>                  <span class="at">pasture =</span> <span class="dv">1000</span><span class="sc">*</span>pasture,</span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a>                  <span class="at">land_area =</span> <span class="dv">1000</span><span class="sc">*</span>land_area) <span class="sc">%&gt;%</span></span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(ISO3, year_code, cropland, pasture, land_area)</span>
<span id="cb1-51"><a href="#cb1-51" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" tabindex="-1"></a>iso.land.covers.<span class="fl">2011.2022</span> <span class="ot">&lt;-</span> land_cover_wide</span>
<span id="cb1-53"><a href="#cb1-53" tabindex="-1"></a>iso.land.covers.<span class="fl">2011.2022</span> <span class="ot">&lt;-</span> gdata<span class="sc">::</span><span class="fu">rename.vars</span>(iso.land.covers.<span class="fl">2011.2022</span>, <span class="at">from=</span><span class="fu">c</span>(<span class="st">&quot;ISO3&quot;</span>, <span class="st">&quot;year_code&quot;</span>), <span class="at">to=</span><span class="fu">c</span>(<span class="st">&quot;iso3&quot;</span>, <span class="st">&quot;year&quot;</span>))</span>
<span id="cb1-54"><a href="#cb1-54" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" tabindex="-1"></a>iso.land.covers.<span class="fl">2011.2022</span> <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(iso.land.covers.<span class="fl">2011.2022</span>,</span>
<span id="cb1-56"><a href="#cb1-56" tabindex="-1"></a>                     <span class="at">id.vars=</span><span class="fu">c</span>(<span class="st">&quot;iso3&quot;</span>,<span class="st">&quot;year&quot;</span>),</span>
<span id="cb1-57"><a href="#cb1-57" tabindex="-1"></a>                     <span class="at">measure.vars=</span><span class="fu">c</span>(<span class="st">&quot;cropland&quot;</span>,<span class="st">&quot;pasture&quot;</span>,<span class="st">&quot;land_area&quot;</span>),</span>
<span id="cb1-58"><a href="#cb1-58" tabindex="-1"></a>                     <span class="at">variable.name=</span><span class="st">&#39;use&#39;</span>,</span>
<span id="cb1-59"><a href="#cb1-59" tabindex="-1"></a>                     <span class="at">value.name=</span><span class="st">&#39;value&#39;</span>)</span>
<span id="cb1-60"><a href="#cb1-60" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" tabindex="-1"></a>iso.land.covers.<span class="fl">2011.2022</span><span class="sc">$</span>unit <span class="ot">&lt;-</span> <span class="st">&quot;ha&quot;</span></span></code></pre></div>
</div>
<div id="use-country-level-data-on-the-share-of-different-land-covers-in-2000-to-infer-annual-areas-of-land-covers-other-than-cropland-and-pasture" class="section level2">
<h2><strong>Use country-level data on the share of different land covers
in 2000 to infer annual areas of land covers other than cropland and
pasture</strong></h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="do">## Read file names of gridded land cover data for year 2000 distributed in gtapshape:</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">document</span>(<span class="st">&quot;..&quot;</span>) <span class="do">## Loads the gtapshape package</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>gridded.landcover.file.names <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">system.file</span>(<span class="st">&quot;land_cover_2000&quot;</span>, <span class="at">package =</span> <span class="st">&quot;gtapshape&quot;</span>),</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>                        <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.rda$&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="do">##summary(aez18)</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="do">##class(aez18)</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="do">## Make a gridded dataframe from the SF file with subnational</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="do">## boundaries (uses the aez18 raster of subnational bounds which is</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="do">## the default, but could use any other because here we will get rid</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="do">## of the subnational bounds and focus on country level aggregates):</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">make_subnatbound_gridded_dataframe</span>()</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>ha.by.iso3<span class="fl">.6</span>covers <span class="ot">&lt;-</span> <span class="fu">all_uses_by_subnatbound</span>(</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>    <span class="at">GADM_subnatbound_df=</span> g,</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>    <span class="at">gridded.use.file.names=</span>gridded.landcover.file.names) <span class="sc">%&gt;%</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>    <span class="fu">group_by</span>(use,iso3) <span class="sc">%&gt;%</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">iso3.by.use.area =</span> <span class="fu">sum</span>(subnatbound.value, <span class="at">na.rm=</span><span class="cn">TRUE</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>    <span class="fu">group_by</span>(iso3) <span class="sc">%&gt;%</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iso3.area =</span> <span class="fu">sum</span>(iso3.by.use.area, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>           <span class="at">use.share.by.iso3 =</span>  iso3.by.use.area<span class="sc">/</span>iso3.area)</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>urban <span class="ot">&lt;-</span> ha.by.iso3<span class="fl">.6</span>covers <span class="sc">%&gt;%</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(use <span class="sc">==</span>  <span class="st">&quot;urban&quot;</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>    <span class="fu">select</span>(iso3,iso3.by.use.area) <span class="sc">%&gt;%</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>    <span class="fu">unique</span>()</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="do">## The problem to be solved is to create areas other thea cropland and</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="do">## pasture for each year in the FAO database:</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>iso.land.covers.<span class="dv">2011</span>.<span class="fl">2022.</span>w <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">dcast</span>(</span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>                                             iso.land.covers.<span class="fl">2011.2022</span>,</span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>                                             iso3<span class="sc">+</span>year<span class="sc">~</span>use,</span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>                                             <span class="at">value.var=</span><span class="st">&quot;value&quot;</span>)</span></code></pre></div>
<p>Below we calculate the area of each country without a cover
classification in FAOSTAT. This area is the difference between a
country’s total land area (fixed over time) and the annual sum of
cropland, pasture, and urban area, the latter also fixed over time.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="do">## Start by getting the filling ha:</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>unasigned.land.area.by.year <span class="ot">&lt;-</span> <span class="fu">left_join</span>(iso.land.covers.<span class="dv">2011</span>.<span class="fl">2022.</span>w,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>                  ha.by.iso3<span class="fl">.6</span>covers <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">filter</span>(use <span class="sc">==</span>  <span class="st">&quot;urban&quot;</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>                  <span class="fu">select</span>(iso3,iso3.by.use.area) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>                  <span class="fu">unique</span>(),</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>                  <span class="at">by=</span><span class="fu">c</span>(<span class="st">&#39;iso3&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;urban&quot;</span><span class="ot">=</span><span class="st">&quot;iso3.by.use.area&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">unasigned.ha =</span> land_area <span class="sc">-</span> cropland <span class="sc">-</span> pasture <span class="sc">-</span> urban)</span></code></pre></div>
<p>The annual <code>unsasigned.ha</code> are split into forests,
shrublands, grasslands and other uses according to the shares of these
covers on land area other than croplands, pastures, and urban extent
(which is assumed to be constant over time):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="do">## Corrected forest, grassland, shrubland, and other lands shares (the correction keep urban area constant.)</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>c.shr <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">dcast</span>(ha.by.iso3<span class="fl">.6</span>covers, iso3 <span class="sc">~</span> use, <span class="at">value.var =</span> <span class="st">&quot;use.share.by.iso3&quot;</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>c.shr<span class="sc">$</span>noncroppasturban.ha <span class="ot">&lt;-</span> <span class="fu">with</span>(c.shr, forest <span class="sc">+</span> grassland <span class="sc">+</span> other <span class="sc">+</span> pasture <span class="sc">+</span> shrubland)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>c.shr<span class="sc">$</span>forest.s <span class="ot">&lt;-</span> <span class="fu">with</span>(c.shr, forest<span class="sc">/</span>noncroppasturban.ha)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>c.shr<span class="sc">$</span>other.s <span class="ot">&lt;-</span> <span class="fu">with</span>(c.shr, other<span class="sc">/</span>noncroppasturban.ha)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>c.shr<span class="sc">$</span>grassland.s <span class="ot">&lt;-</span> <span class="fu">with</span>(c.shr, grassland<span class="sc">/</span>noncroppasturban.ha)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>c.shr<span class="sc">$</span>shrubland.s <span class="ot">&lt;-</span> <span class="fu">with</span>(c.shr, shrubland<span class="sc">/</span>noncroppasturban.ha)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>iso.land.cover.<span class="fl">2011.2022</span> <span class="ot">&lt;-</span> <span class="fu">left_join</span>(unasigned.land.area.by.year,</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>                  c.shr[,<span class="fu">c</span>(<span class="st">&quot;iso3&quot;</span>, <span class="st">&quot;forest.s&quot;</span>,</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>                           <span class="st">&quot;other.s&quot;</span>, <span class="st">&quot;grassland.s&quot;</span>, <span class="st">&quot;shrubland.s&quot;</span> )],</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>                  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;iso3&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">forest =</span> unasigned.ha<span class="sc">*</span>forest.s,</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>           <span class="at">other =</span>  unasigned.ha<span class="sc">*</span>other.s,</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>           <span class="at">grassland =</span> unasigned.ha<span class="sc">*</span>grassland.s,</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>           <span class="at">shrubland =</span> unasigned.ha<span class="sc">*</span>shrubland.s) <span class="sc">%&gt;%</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>    <span class="fu">select</span>(iso3, year, cropland, pasture, urban, forest,</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>           other, grassland, shrubland) <span class="sc">%&gt;%</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Forest =</span> forest,</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>                  <span class="at">SavnGrasslnd =</span> grassland,</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>                  <span class="at">Shrubland =</span> shrubland,</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>                  <span class="at">Cropland =</span> cropland,</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>                  <span class="at">Pastureland =</span> pasture,</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>                  <span class="at">Builtupland =</span> urban,</span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>                  <span class="at">Otherland =</span> other) <span class="sc">%&gt;%</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>        <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&#39;Forest&#39;</span>, <span class="st">&#39;SavnGrasslnd&#39;</span>, <span class="st">&#39;Shrubland&#39;</span>, <span class="st">&#39;Cropland&#39;</span>, <span class="st">&#39;Pastureland&#39;</span>, <span class="st">&#39;Builtupland&#39;</span>, <span class="st">&#39;Otherland&#39;</span>),</span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">&quot;gsc3&quot;</span>,</span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>iso.land.cover.<span class="fl">2011.2022</span><span class="sc">$</span>unit <span class="ot">&lt;-</span> <span class="st">&quot;ha&quot;</span></span></code></pre></div>
<p>The dataset with update land covers by country is saved in the
<code>gtapshape</code> package for lazy loading:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_data</span>(iso.land.cover.<span class="fl">2011.2022</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="do">##usethis::use_r(&quot;iso.land.cover.2011.2022.R&quot;)</span></span></code></pre></div>
<p>Finally, a note about country coverage: The gridded land cover data
for 2000 covers 185 countries while FAOSTAT’s annual country-level data
covers 236 countries. There are 171 countries with data in both
datasets, which are the ones for which this update work. The countries
for which we cannot assign land cover data are small countries mostly
captured by the aggregated GTAP regions <code>X??</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">## The gridded land cover data for 2000 covers 185 countries while</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="do">## FAOSTAT&#39;s annual country-level data covers 236 countries. There are</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="do">## 171 countries with data in both datasets, which are the ones for</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="do">## which this update work:</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>countries.in.both.datasets <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">unique</span>(ha.by.iso3<span class="fl">.6</span>covers<span class="sc">$</span>iso3), <span class="fu">unique</span>(iso.land.covers.<span class="fl">2011.2022</span><span class="sc">$</span>iso3))</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>countries.that.cant.be.updated <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(iso.land.covers.<span class="fl">2011.2022</span><span class="sc">$</span>iso3), countries.in.both.datasets)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>by.reg <span class="ot">&lt;-</span> <span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">iso3=</span>countries.that.cant.be.updated),regional.concordance, <span class="at">by =</span> <span class="st">&quot;iso3&quot;</span>)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="fu">table</span>(by.reg<span class="sc">$</span>reg)</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
