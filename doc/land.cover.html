<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Micah Cameron-Harp and Nelson Villoria" />

<meta name="date" content="2025-02-23" />

<title>Process global land cover rasters</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Process global land cover rasters</h1>
<h4 class="author">Micah Cameron-Harp and Nelson Villoria</h4>
<h4 class="date">2025-02-23</h4>



<p>This vignette will go over how we generate data on the 7 land cover
types present in the GTAP Land Use and Land Cover datasets used in the
<em>gtapshape</em> package. The data are created using publicly
available raster data depicting the distribution of cropland and
pastureland, potential vegetation classes, and urban areas. In each
sub-section below, we detail how the underlying raster data was
pre-processed. The raster data used in each sub-section are downloaded
when the function is executed. Note, some of the pre-processing
described here mirrors the processes described by Baldos (2017) in
“Development of GTAP version 9 Land Use and Land Cover database for
years 2004, 2007 and 2011.” (Available at <a href="https://doi.org/10.21642/GTAP.RM30" class="uri">https://doi.org/10.21642/GTAP.RM30</a>)</p>
<div id="urban-land-cover" class="section level2">
<h2><strong>Urban land cover</strong></h2>
<p>The urban land cover data are from Schneider, Friedl, and Potere
(2010). The raster is categorical in nature, indicating the raster cells
which are urban at a 500 meter resolution. A complete description of the
data can be found in the article at: <a href="https://doi.org/10.1016/j.rse.2010.03.003" class="uri">https://doi.org/10.1016/j.rse.2010.03.003</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>  <span class="co">#Read in the urban land cover raster</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    urban_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;./raw_data/urban_land_cover_modis/2002v5_urban_only_geog_mos.bip&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="co">#Check the header file</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    hdr_file <span class="ot">&lt;-</span> <span class="st">&quot;./raw_data/urban_land_cover_modis/2002v5_urban_only_geog_mos.hdr&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    hdr_file <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="at">con =</span> hdr_file)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    <span class="co">#Display information in header file</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    hdr_file</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    <span class="co">#Correct the extent</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">ext</span>(urban_rast) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">180</span>, <span class="sc">-</span><span class="fl">89.979167</span>, <span class="dv">90</span>)</span></code></pre></div>
<p>We modify the base urban cover raster in two ways to ensure it is
compatible with the other spatial data used in later processes. First,
we reclassify the values of the raster so that urban areas have a value
of 1 and all other areas have a value of zero.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a> <span class="co">#Reclassify so urban areas have a value of 1, all other areas are 0</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    rcl_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">0</span>,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>                        <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">1</span>,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>                        <span class="dv">13</span>, <span class="dv">255</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    urban_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(urban_rast, rcl_mat, <span class="at">right =</span> T)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="co">#Replace NA values with zeroes</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    urban_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(urban_rast, <span class="fu">cbind</span>(<span class="cn">NA</span>, <span class="dv">0</span>))</span></code></pre></div>
<p>Second, we reproject the raster so it has the same Coordinate
Reference System (EPSG 4326) and resolution (5 arc-minutes) as the other
data. To do this, we use the and functions.to make an empty raster with
the target CRS and resolution.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>  <span class="co">#Create a new global raster using the &quot;make.global.raster&quot; function with the</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="co">#target CRS and resolution. We will use it to create a new urban land cover</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="co">#raster with the same resolution and crs (projection).</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    global_rast <span class="ot">&lt;-</span> <span class="fu">make.global.raster</span>()</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="co">#Project the urban cover raster into the new CRS and resample to correct resolution</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    urban_rast <span class="ot">&lt;-</span> <span class="fu">apply_global_raster_properties</span>(urban_rast, global_rast)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="co">#Save resulting output as .tif</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">writeRaster</span>(urban_rast, </span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>                       <span class="at">filename =</span> <span class="fu">file.path</span>(workdir_dir, <span class="st">&#39;workdir/rasters/urban_cover.tif&#39;</span>),</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>                       <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    </span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  <span class="co">#Cleanup</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    <span class="fu">gc</span>()</span></code></pre></div>
</div>
<div id="potential-vegetation" class="section level2">
<h2><strong>Potential vegetation</strong></h2>
<p>The potential vegetation data are from Ramankutty and Foley (1999).
The original raster data is categorical, displaying 13 different
potential vegetation classes. A complete description of the data can be
found in the article at: <a href="https://doi.org/10.1029/1999GB900046" class="uri">https://doi.org/10.1029/1999GB900046</a>. The specific
raster used in this vignette was downloaded in ASCII format from:<a href="https://sage.nelson.wisc.edu/data-and-models/datasets/global-potential-vegetation-dataset/" class="uri">https://sage.nelson.wisc.edu/data-and-models/datasets/global-potential-vegetation-dataset/</a>.</p>
<p>For our analyses, we collapse the original 13 classes into 4
categories: “Forests”, “Shrubland”, “Savanna + Grassland”, and “Other
Lands” as in Baldos (2017).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co">#Load in the Potential Vegetation Data from Ramankutty and Foley</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  pot_veg_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;glpotveg_5min_orig.asc&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#Now we need to reclassify them into four categories as in Baldoz (2009)</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  rcl_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>, <span class="dv">1</span>,</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>                      <span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">2</span>,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>                      <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">3</span>,</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>                      <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">4</span>), <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  pot_veg_4cat <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(pot_veg_rast, rcl_mat)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  <span class="co">#Label the values</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  pot_veg_4cat_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>  pot_veg_4cat_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Forests&quot;</span>, <span class="st">&quot;Shrubland&quot;</span>, <span class="st">&quot;Savanna + Grassland&quot;</span>, <span class="st">&quot;Other Lands&quot;</span>)</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  pot_veg_4cat <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">subst</span>( pot_veg_4cat,  pot_veg_4cat_values, pot_veg_4cat_labels)</span></code></pre></div>
<p>Next, we save each of these four potential vegetation classes as
individual rasters. Along with the cropland, pastureland, and urban land
cover types, these make up the 7 total land cover types present in a
GTAP LULC database.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>  <span class="co">#First create a global raster with the desired CRS and resolution to ensure</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="co">#the potential vegetation rasters will conform with other raster data. </span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    global_rast <span class="ot">&lt;-</span> <span class="fu">make.global.raster</span>()</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  </span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="co">#Create a forest potential veg raster</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    rcl_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>                        <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    forest_pot_veg <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(pot_veg_4cat, rcl_mat, <span class="at">right =</span> T)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>    <span class="co">#Project the forest potential vegetation raster into the new CRS and </span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    <span class="co">#resample to correct resolution</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>    forest_pot_veg <span class="ot">&lt;-</span> <span class="fu">apply_global_raster_properties</span>(forest_pot_veg, global_rast)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">writeRaster</span>(forest_pot_veg, <span class="at">filename =</span> <span class="fu">file.path</span>(workdir_dir, <span class="st">&quot;workdir/rasters/forest_pot_veg.tif&quot;</span>), <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  <span class="co">#Shrubland potential veg</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>    <span class="co">#Note, reclassification matrix terms represent the order of the levels</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>    <span class="co">#of the categorical raster. So the order is now Forest, Other lands, Savanna,</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>    <span class="co">#then Shrubland.</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>    rcl_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">0</span>,</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>                        <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T)</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>    shrubland_pot_veg <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(pot_veg_4cat, rcl_mat, <span class="at">right =</span> T)</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>    <span class="co">#Project the shrubland potential vegetation raster into the new CRS and </span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>    <span class="co">#resample to correct resolution</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>    shrubland_pot_veg <span class="ot">&lt;-</span> <span class="fu">apply_global_raster_properties</span>(shrubland_pot_veg, global_rast)</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">writeRaster</span>(shrubland_pot_veg, </span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>                       <span class="at">filename =</span> <span class="fu">file.path</span>(workdir_dir, <span class="st">&quot;workdir/rasters/shrubland_pot_veg.tif&quot;</span>),</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>                       <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>  <span class="co">#Savanna and grassland potential veg</span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>    rcl_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>,</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>                        <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>,</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>                        <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T)</span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>    savanna_grass_pot_veg <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(pot_veg_4cat, rcl_mat, <span class="at">right =</span> T)</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>    <span class="co">#Project the savanna/grassland potential vegetation raster into the new CRS and </span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>    <span class="co">#resample to correct resolution</span></span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a>    savanna_grass_pot_veg <span class="ot">&lt;-</span> <span class="fu">apply_global_raster_properties</span>(savanna_grass_pot_veg, global_rast)</span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">writeRaster</span>(savanna_grass_pot_veg, </span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a>                       <span class="at">filename =</span> <span class="fu">file.path</span>(workdir_dir, <span class="st">&quot;workdir/rasters/savanna_grass_pot_veg.tif&quot;</span>),</span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a>                       <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a>  <span class="co">#Other vegetation types like tundra, bare rock, etc.</span></span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a>    rcl_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a>                        <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>,</span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a>                        <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T)</span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a>    other_pot_veg <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(pot_veg_4cat, rcl_mat, <span class="at">right =</span> T)</span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a>    <span class="co">#Project the raster for the &quot;other&quot; category of potential vegetation into the</span></span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a>    <span class="co">#new CRS and resample to correct resolution</span></span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a>    other_pot_veg <span class="ot">&lt;-</span> <span class="fu">apply_global_raster_properties</span>(other_pot_veg, global_rast)</span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">writeRaster</span>(other_pot_veg,  <span class="at">filename =</span> <span class="fu">file.path</span>(workdir_dir, <span class="st">&quot;workdir/rasters/other_pot_veg.tif&quot;</span>), <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a>    </span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a>  <span class="co">#Cleanup</span></span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb5-52"><a href="#cb5-52" tabindex="-1"></a>    <span class="fu">gc</span>()</span></code></pre></div>
</div>
<div id="cropland-and-pastureland" class="section level2">
<h2><strong>Cropland and pastureland</strong></h2>
<p>The cropland and pastureland data are described in the paper by
Ramankutty et al. (2008), titled “Farming the planet: 1. Geographic
distribution of global agricultural lands in the year 2000.” The paper
can be found at: <a href="https://doi.org/10.1029/2007GB002952" class="uri">https://doi.org/10.1029/2007GB002952</a>. The raster data
are categorical in nature, with cell values indicating whether the
fraction of cell area categorized as cropland or pastureland at a 5
minute resolution. The two rasters used in this vignette, one for
cropland and the other for pastureland, were downloaded from <a href="http://www.earthstat.org/cropland-pasture-area-2000/" class="uri">http://www.earthstat.org/cropland-pasture-area-2000/</a>.</p>
<p>First, we load in the cropland and pastureland rasters. We then use
the and to ensure the resulting data have the target CRS (EPSG 4326) and
resolution.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a> <span class="co">#Cropland and pasture coverage</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>    <span class="co">#First create a global raster with the desired CRS and resolution</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>      global_rast <span class="ot">&lt;-</span> <span class="fu">make.global.raster</span>()</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    <span class="co">#Load cropland raster</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>      cropland_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;./raw_data/CroplandPastureArea2000_Geotiff/Cropland2000_5m.tif&quot;</span>)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>      <span class="co">#Make sure the cropland raster CRS and resolution match other rasters</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>      cropland_rast <span class="ot">&lt;-</span> <span class="fu">apply_global_raster_properties</span>(cropland_rast, global_rast)</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>    </span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    <span class="co">#Load pastureland raster</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>      pasture_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;./raw_data/CroplandPastureArea2000_Geotiff/Pasture2000_5m.tif&quot;</span>)</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>      <span class="co">#Make sure the pastureland raster CRS and resolution match other rasters</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>      pasture_rast <span class="ot">&lt;-</span> <span class="fu">apply_global_raster_properties</span>(pasture_rast, global_rast)</span></code></pre></div>
</div>
<div id="combine-land-cover-types-normalize-convert-from-fractional-to-area-data" class="section level2">
<h2><strong>Combine land cover types, normalize, convert from fractional
to area data</strong></h2>
<p>The final step in this vignette is to combine the various land covers
and ensure the sum of all land cover fractions for any individual cell
does not exceed 100% of the cell area. As in Baldos (2017), we begin by
combining the cropland, pastureland, and urban area rasters. We then
normalize any cells where the sum of the the cropland, pastureland, and
urban area fractions is greater than 1.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>  <span class="co">#Urban - created by urban_land_cover function</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    urban_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">file.path</span>(workdir_dir, <span class="st">&#39;workdir/rasters/urban_cover.tif&#39;</span>))</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="co">#Join the cropland, pastureland, and urban rasters together</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    rast_stack <span class="ot">&lt;-</span> <span class="fu">c</span>(cropland_rast, pasture_rast, urban_rast)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="co">#Now make a new raster adding the others together</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    sum_covers <span class="ot">&lt;-</span> rast_stack[[<span class="dv">1</span>]] <span class="sc">+</span> rast_stack[[<span class="dv">2</span>]] <span class="sc">+</span> rast_stack[[<span class="dv">3</span>]]</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>      <span class="co">#some values look like they&#39;re above one, so more than 100% landcover</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>      sum_covers_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">values</span>(sum_covers))</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>      sum_covers_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sum_covers_vals)</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>      sum_covers_df <span class="ot">&lt;-</span> sum_covers_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">vals =</span> <span class="fu">as.numeric</span>(sum_covers_vals))</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>      sum_covers_df <span class="ot">&lt;-</span> sum_covers_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(vals))</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>  <span class="co">#Now we need to normalize the cells with total covers greater than 1. To do</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>  <span class="co">#this we create a new raster which we will divide each of the land cover</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>  <span class="co">#rasters by. </span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>    <span class="fu">rm</span>(cropland_rast, pasture_rast, urban_rast)</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>    <span class="fu">gc</span>()</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>    <span class="co">#Make reclassification matrix</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>    <span class="co">#Make values that aren&#39;t &gt;1 equal 1. Then when we use the divide the individual</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>    <span class="co">#rasters by the resulting raster, all values below one stay the same and those above 1 are normalized</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>    rclmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(m, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>    sum_covers_over1 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(sum_covers, rclmat)</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>    <span class="co">#Make new normalized rasters for cropland, pastureland, and urban areas</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>    norm_crop <span class="ot">&lt;-</span> rast_stack[[<span class="dv">1</span>]]<span class="sc">/</span>sum_covers_over1</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>    norm_pasture <span class="ot">&lt;-</span> rast_stack[[<span class="dv">2</span>]]<span class="sc">/</span>sum_covers_over1</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>    norm_urban <span class="ot">&lt;-</span> rast_stack[[<span class="dv">3</span>]]<span class="sc">/</span>sum_covers_over1</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>    <span class="co">#Replace NA values with 0&#39;s and save the new normalized rasters</span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a>    norm_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(norm_crop, <span class="fu">cbind</span>(<span class="cn">NA</span>, <span class="dv">0</span>))</span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">writeRaster</span>(norm_crop, </span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>                       <span class="at">filename =</span> <span class="fu">file.path</span>(workdir_dir, <span class="st">&#39;workdir/rasters/crop_cover_fraction.tif&#39;</span>),</span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>                       <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a>    norm_pasture <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(norm_pasture, <span class="fu">cbind</span>(<span class="cn">NA</span>, <span class="dv">0</span>))</span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">writeRaster</span>(norm_pasture,</span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a>                       <span class="at">filename =</span> <span class="fu">file.path</span>(workdir_dir, <span class="st">&#39;workdir/rasters/pasture_cover_fraction.tif&#39;</span>),</span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a>                       <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a>    norm_urban <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(norm_urban, <span class="fu">cbind</span>(<span class="cn">NA</span>, <span class="dv">0</span>))</span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">writeRaster</span>(norm_urban,</span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a>                       <span class="at">filename =</span> <span class="fu">file.path</span>(workdir_dir, <span class="st">&#39;workdir/rasters/urban_cover_fraction.tif&#39;</span>),</span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a>                       <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Now, for cells where the sum of the urban, cropland, and pastureland
area fractions is less than one, we allocate the remaining area fraction
to the potential vegetation class.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>  <span class="co">#Last step is to read in the four potential vegetation raster to fill in the missing areas</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>      forest_pot_veg <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">file.path</span>(workdir_dir, <span class="st">&#39;workdir/rasters/forest_pot_veg.tif&#39;</span>))</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>      shrubland_pot_veg <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">file.path</span>(workdir_dir, <span class="st">&#39;workdir/rasters/shrubland_pot_veg.tif&#39;</span>))</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>      savanna_grass_pot_veg <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span> (<span class="fu">file.path</span>(workdir_dir, <span class="st">&#39;workdir/rasters/savanna_grass_pot_veg.tif&#39;</span>))</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>      other_pot_veg <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">file.path</span>(workdir_dir, <span class="st">&#39;workdir/rasters/other_pot_veg.tif&#39;</span>))</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  </span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>      <span class="co">#Make a raster indicating the cell are remaining after accounting for the </span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>      <span class="co">#cropland, pastureland, and urban coverage fractions. Then fill in those</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>      <span class="co">#areas with the potential vegetation types.</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>        sum_croppasturb_norm_rasters <span class="ot">&lt;-</span> norm_crop <span class="sc">+</span> norm_pasture <span class="sc">+</span> norm_urban</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>       <span class="co">#Now make a raster showing where we need to fill in land cover using the</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>        <span class="co">#potential vegetation rasters.</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>        pot_veg_to_fill <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> sum_croppasturb_norm_rasters</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>      <span class="co">#Make final forest cover</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>        final_forest_cov <span class="ot">&lt;-</span> forest_pot_veg <span class="sc">*</span> pot_veg_to_fill</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>        final_forest_cov <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(final_forest_cov, <span class="fu">cbind</span>(<span class="cn">NA</span>, <span class="dv">0</span>))</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">writeRaster</span>(final_forest_cov, </span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>                           <span class="at">filename =</span> <span class="fu">file.path</span>(workdir_dir, <span class="st">&#39;workdir/rasters/forest_cover_fraction.tif&#39;</span>), </span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>                           <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>      <span class="co">#Make final shrubland cover</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>        final_shrubland_cover <span class="ot">&lt;-</span> shrubland_pot_veg <span class="sc">*</span> pot_veg_to_fill</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>        final_shrubland_cover <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(final_shrubland_cover, <span class="fu">cbind</span>(<span class="cn">NA</span>, <span class="dv">0</span>))</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>        <span class="fu">writeRaster</span>(final_shrubland_cover, </span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>                    <span class="at">filename =</span> <span class="fu">file.path</span>(workdir_dir, <span class="st">&#39;workdir/rasters/shrubland_cover_fraction.tif&#39;</span>), </span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>                    <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>      <span class="co">#Make final grassland cover</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>        final_grass_cover <span class="ot">&lt;-</span> savanna_grass_pot_veg <span class="sc">*</span> pot_veg_to_fill</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>        final_grass_cover <span class="ot">&lt;-</span> <span class="fu">classify</span>(final_grass_cover, <span class="fu">cbind</span>(<span class="cn">NA</span>, <span class="dv">0</span>))</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">writeRaster</span>(final_grass_cover, </span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>                           <span class="at">filename =</span> <span class="fu">file.path</span>(workdir_dir, <span class="st">&#39;workdir/rasters/grassland_cover_fraction.tif&#39;</span>),</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>                           <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>      <span class="co">#Make final other cover</span></span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>        final_other_cover <span class="ot">&lt;-</span> other_pot_veg <span class="sc">*</span> pot_veg_to_fill</span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a>        final_other_cover <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">classify</span>(final_other_cover, <span class="fu">cbind</span>(<span class="cn">NA</span>, <span class="dv">0</span>))</span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">writeRaster</span>(final_other_cover, </span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a>                           <span class="at">filename =</span> <span class="fu">file.path</span>(workdir_dir, <span class="st">&#39;workdir/rasters/other_cover_fraction.tif&#39;</span>), </span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a>                           <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a>    </span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a>  <span class="co">#Cleanup</span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a>    <span class="fu">gc</span>()</span></code></pre></div>
<p>Next, we take the rasters depicting fractional land cover data and
create rasters depicting the area in each land cover instead. To do
this, we make use of the function from the ‘terra’ package. We multiply
the rasters containing coverage fractions by the area of the cells to
get the total area of each land cover for a given raster cell.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">#Load in the land cover rasters containing the fraction of each cell</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>baseyr_lc_frac_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&#39;workdir/rasters/&#39;</span>, </span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>                                  <span class="at">pattern =</span> <span class="st">&quot;fraction.tif&quot;</span>,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>                                  <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>base_year_frac_rasts <span class="ot">&lt;-</span> <span class="fu">lapply</span>(baseyr_lc_frac_list, terra<span class="sc">::</span>rast)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#Get the area of grid cells in hectares using the terra package</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>grid_cell_area <span class="ot">&lt;-</span> <span class="fu">cellSize</span>(base_year_frac_rasts[[<span class="dv">1</span>]], <span class="at">mask=</span><span class="cn">FALSE</span>, <span class="at">lyrs=</span><span class="cn">FALSE</span>, <span class="at">unit=</span><span class="st">&quot;ha&quot;</span>, <span class="at">transform=</span><span class="cn">TRUE</span>)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#Create new rasters showing the hectares in each land cover type</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)) {</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>  cover_rast_ha <span class="ot">&lt;-</span>  base_year_frac_rasts[[i]] <span class="sc">*</span> grid_cell_area</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>  out_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(baseyr_lc_frac_list[i])</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>  out_name <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&#39;fraction.tif&#39;</span>, <span class="st">&#39;ha.tif&#39;</span>, out_name)</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>  <span class="fu">writeRaster</span>(cover_rast_ha, <span class="at">filename =</span> <span class="fu">paste0</span>(out_name), <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="convert-from-raster-to-dataframe-and-save" class="section level2">
<h2><strong>Convert from raster to dataframe and save</strong></h2>
<p>Last, we transform the area rasters into dataframes and output them
as compressed .rda files. These files are saved in the
<em>gtapshape</em> package directory. This process includes the
following steps:</p>
<ol style="list-style-type: decimal">
<li>Load the rasters containing land cover data in hectares and store
the land cover names</li>
<li>Ensure they have the correct CRS and extent using the function.</li>
<li>Convert the raster to a dataframe and keep only positive zero
values.</li>
<li>Round up the latitude and longitude coordinates in the resulting
dataframe to six digits. This uses the function.</li>
<li>Save the dataframe as a .rda compressed file within the
<em>gtapshape</em> package data.</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">lapply</span>( baseyr_lc_ha_file_names, <span class="cf">function</span>(.r){</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>    <span class="do">## (.r &lt;- baseyr_lc_ha_file_names[[5]])</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>    r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(.r)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    filename <span class="ot">&lt;-</span> tools<span class="sc">::</span><span class="fu">file_path_sans_ext</span>(<span class="fu">basename</span>(.r))</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>    <span class="fu">names</span>(r) <span class="ot">&lt;-</span><span class="fu">sub</span>(<span class="st">&quot;_ha$&quot;</span>, <span class="st">&quot;&quot;</span>, filename)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    <span class="do">## Ensure raster has the default resolution, extent, and</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    <span class="do">## coordinate reference system:</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">apply_global_raster_properties</span>(<span class="at">input.raster =</span> r, <span class="at">global.raster =</span> gr)</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(r, <span class="at">xy=</span><span class="cn">TRUE</span>)</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>    <span class="do">## Keep only positive values to decrease file size:</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>    c <span class="ot">&lt;-</span> <span class="fu">colnames</span>(r)[<span class="dv">3</span>]</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>    r1 <span class="ot">&lt;-</span> r <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(c)<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>    <span class="do">## Round up geographic coordinates to ensure compatibility with</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>    <span class="do">## the country-geography raster used for aggregation:</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>    r1 <span class="ot">&lt;-</span> <span class="fu">round_up_coordinates</span>(<span class="at">raster.df=</span>r1)</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>    <span class="fu">assign</span>(filename,r1)</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>    supplementary.data.path <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;land_cover_2000&quot;</span>, <span class="at">package =</span> <span class="st">&quot;gtapshape&quot;</span>)</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>    <span class="fu">save</span>(<span class="at">list=</span>filename, <span class="at">file=</span> <span class="fu">file.path</span>(supplementary.data.path, <span class="fu">paste</span>(filename,<span class="st">&quot;.rda&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)), <span class="at">compress =</span> <span class="st">&quot;xz&quot;</span>,</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>         <span class="at">compression_level =</span> <span class="dv">9</span>)</span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>}</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>)</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
